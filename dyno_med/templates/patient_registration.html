<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Registration</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2>Patient Registration</h2>
        <form id="patientForm">
            <div class="form-group">
                <label for="full_name">Full Name</label>
                <input type="text" class="form-control" id="full_name" required>
            </div>
            <div class="form-group">
                <label for="birthday">Birthday</label>
                <input type="date" class="form-control" id="birthday" required>
            </div>
            <div class="form-group">
                <label for="gender">Gender</label>
                <select class="form-control" id="gender" required>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label for="contact_information">Contact Information</label>
                <input type="text" class="form-control" id="contact_information">
            </div>
            <div class="form-group">
                <label for="emergency_contact">Emergency Contact</label>
                <input type="text" class="form-control" id="emergency_contact">
            </div>
            <div class="form-group">
                <label for="blood_group">Blood Group</label>
                <select class="form-control" id="blood_group">
                    <option value="A">A</option>
                    <option value="B">B</option>
                    <option value="AB">AB</option>
                    <option value="O">O</option>
                    <option value="Unknown">Unknown</option>
                </select>
            </div>
            <div class="form-group">
                <label for="rhesus_factor">Rhesus Factor</label>
                <select class="form-control" id="rhesus_factor">
                    <option value="Positive">Positive</option>
                    <option value="Negative">Negative</option>
                    <option value="Unknown">Unknown</option>
                </select>
            </div>
            <div class="form-group">
                <label for="insurance_information">Insurance Information</label>
                <input type="text" class="form-control" id="insurance_information">
            </div>

            <h4>Current Health Information</h4>
            <div class="form-group">
                <label for="chief_complaint">Chief Complaint</label>
                <input type="text" class="form-control" id="chief_complaint">
            </div>
            <div class="form-group">
                <label for="symptoms">Symptoms (comma separated)</label>
                <input type="text" class="form-control" id="symptoms">
            </div>
            <div class="form-group">
                <label for="diagnoses">Diagnoses (comma separated)</label>
                <input type="text" class="form-control" id="diagnoses">
            </div>
            <h5>Vital Signs</h5>
            <div class="form-group">
                <label for="blood_pressure">Blood Pressure</label>
                <input type="text" class="form-control" id="blood_pressure">
            </div>
            <div class="form-group">
                <label for="heart_rate">Heart Rate</label>
                <input type="number" class="form-control" id="heart_rate">
            </div>
            <div class="form-group">
                <label for="temperature">Temperature</label>
                <input type="number" step="0.1" class="form-control" id="temperature">
            </div>
            <div class="form-group">
                <label for="respiration_rate">Respiration Rate</label>
                <input type="number" class="form-control" id="respiration_rate">
            </div>
            <h5>Medications</h5>
            <div id="medications">
                <div class="medication-entry">
                    <div class="form-group">
                        <label for="med_name">Medication Name</label>
                        <input type="text" class="form-control" id="med_name">
                    </div>
                    <div class="form-group">
                        <label for="dosage">Dosage</label>
                        <input type="text" class="form-control" id="dosage">
                    </div>
                    <div class="form-group">
                        <label for="usage">Usage</label>
                        <input type="text" class="form-control" id="usage">
                    </div>
                    <div class="form-group">
                        <label for="start_date">Start Date</label>
                        <input type="date" class="form-control" id="start_date">
                    </div>
                    <div class="form-group">
                        <label for="end_date">End Date</label>
                        <input type="date" class="form-control" id="end_date">
                    </div>
                </div>
            </div>
            <button type="button" class="btn btn-secondary" id="addMed">Add Another Medication</button>
            <div class="form-group mt-3">
                <label for="immunization_records">Immunization Records (comma separated)</label>
                <input type="text" class="form-control" id="immunization_records">
            </div>
            <div class="form-group mt-3">
                <label for="Appointment ">Appointment  (Specify the next appointment  if necessay)</label>
                <input type="date" class="form-control" id="immunization_records">
            </div>
            <button type="submit" class="btn btn-primary">Register</button>
        </form>
    </div>

    <script>
        document.getElementById('addMed').addEventListener('click', function() {
            const medEntry = document.createElement('div');
            medEntry.className = 'medication-entry';
            medEntry.innerHTML = `
                <div class="form-group">
                    <label for="med_name">Medication Name</label>
                    <input type="text" class="form-control" id="med_name">
                </div>
                <div class="form-group">
                    <label for="dosage">Dosage</label>
                    <input type="text" class="form-control" id="dosage">
                </div>
                <div class="form-group">
                    <label for="start_date">Start Date</label>
                    <input type="date" class="form-control" id="start_date">
                </div>
                <div class="form-group">
                    <label for="end_date">End Date</label>
                    <input type="date" class="form-control" id="end_date">
                </div>
            `;
            document.getElementById('medications').appendChild(medEntry);
        });

        document.getElementById('patientForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const formData = {
                full_name: document.getElementById('full_name').value,
                birthday: document.getElementById('birthday').value,
                gender: document.getElementById('gender').value,
                contact_information: document.getElementById('contact_information').value,
                emergency_contact: document.getElementById('emergency_contact').value,
                blood_group: document.getElementById('blood_group').value,
                rhesus_factor: document.getElementById('rhesus_factor').value,
                insurance_information: document.getElementById('insurance_information').value,
                current_health_information: {
                    chief_complaint: document.getElementById('chief_complaint').value,
                    symptoms: document.getElementById('symptoms').value.split(','),
                    diagnoses: document.getElementById('diagnoses').value.split(','),
                    vital_signs: {
                        blood_pressure: document.getElementById('blood_pressure').value,
                        heart_rate: parseInt(document.getElementById('heart_rate').value),
                        temperature: parseFloat(document.getElementById('temperature').value),
                        respiration_rate: parseInt(document.getElementById('respiration_rate').value)
                    },
                    medications: Array.from(document.querySelectorAll('.medication-entry')).map(entry => ({
                        name: entry.querySelector('#med_name').value,
                        dosage: entry.querySelector('#dosage').value,
                        start_date: entry.querySelector('#start_date').value,
                        end_date: entry.querySelector('#end_date').value
                    }))
                },
                immunization_records: document.getElementById('immunization_records').value.split(',')
            };

            fetch('http://127.0.0.1:5000/patient/profile', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                alert('Patient registered successfully!');
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred during registration.');
            });
        });
    </script>
</body>
</html>
